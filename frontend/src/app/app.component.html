<div class="main-container" [class.theme-light]="!isDarkMode" [class.rtl]="currentLang === 'ar'">

    <!-- Navigation -->
    <nav class="navbar-pro">
        <div class="nav-wrapper">
            <div class="brand" (click)="switchView('shop')">TECH<span>HUB</span></div>

            <div class="menu-desktop">
                <a (click)="switchView('shop')" [class.active]="currentView === 'shop'">{{ t('store') }}</a>
                <a (click)="switchView('admin')" [class.active]="currentView === 'admin'">{{ t('admin') }}</a>
                <a (click)="switchView('contact')" [class.active]="currentView === 'contact'">{{ t('contact') }}</a>
            </div>

            <div class="nav-controls">
                <div class="lang-switcher">
                    <button (click)="setLanguage('fr')" [class.active]="currentLang === 'fr'">FR</button>
                    <button (click)="setLanguage('en')" [class.active]="currentLang === 'en'">EN</button>
                    <button (click)="setLanguage('ar')" [class.active]="currentLang === 'ar'">AR</button>
                </div>

                <button class="theme-toggle" (click)="toggleTheme()">
                    {{ isDarkMode ? '‚òÄÔ∏è' : 'üåô' }}
                </button>

                <button class="cart-trigger" (click)="toggleCart()">
                    <span class="icon">üõí</span>
                    <span class="badge" *ngIf="cart.length">{{ cart.length }}</span>
                </button>

                <button class="mobile-menu-btn" (click)="toggleMobileMenu()">‚ò∞</button>
            </div>
        </div>

        <!-- Mobile Menu -->
        <div class="mobile-menu" [class.open]="isMobileMenuOpen">
            <a (click)="switchView('shop')">{{ t('store') }}</a>
            <a (click)="switchView('admin')">{{ t('admin') }}</a>
            <a (click)="switchView('contact')">{{ t('contact') }}</a>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="page-content" [class.blurred]="isCartOpen">

        <!-- View: Store -->
        <div *ngIf="currentView === 'shop'" class="animate-in">
            <header class="hero-banner">
                <div class="hero-content">
                    <h1>{{ t('welcome') }}</h1>
                    <p>{{ t('hero_p') }}</p>
                    <div class="search-area">
                        <input [(ngModel)]="searchQuery" [placeholder]="t('search')" type="text">
                    </div>
                </div>
            </header>

            <section class="storefront">
                <div class="category-drawer">
                    <button *ngFor="let cat of categories" [class.active]="currentCategory === cat"
                        (click)="currentCategory = cat">
                        {{ cat }}
                    </button>
                </div>

                <div class="product-grid">
                    <div class="product-card" *ngFor="let product of filteredProducts">
                        <div class="card-img">
                            <img [src]="product.imageUrl" [alt]="product.name"
                                onerror="this.src='https://images.unsplash.com/photo-1550745165-9bc0b252726f?w=400'">
                        </div>
                        <div class="card-info">
                            <h3>{{ product.name }}</h3>
                            <p>{{ product.description }}</p>
                            <div class="card-bottom">
                                <span class="price">${{ product.price | number:'1.2-2' }}</span>
                                <button class="btn-add" (click)="addToCart(product)">{{ t('add_to_cart') }}</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- View: Admin -->
        <div *ngIf="currentView === 'admin'" class="admin-view animate-in">
            <div class="admin-header">
                <h2>üìä {{ t('orders_title') }}</h2>
                <div class="stats-row">
                    <div class="stat">
                        <label>{{ t('orders_title') }}</label>
                        <span>{{ orders.length }}</span>
                    </div>
                    <div class="stat">
                        <label>{{ t('revenue') }}</label>
                        <span>${{ totalRevenue | number:'1.2-2' }}</span>
                    </div>
                </div>
            </div>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Nom</th>
                            <th>Total</th>
                            <th>Status</th>
                            <th>Date</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let order of orders">
                            <td>{{ order.customerName }}</td>
                            <td>${{ order.totalAmount }}</td>
                            <td><span class="status-pill" [attr.data-status]="order.status">{{ order.status }}</span>
                            </td>
                            <td>{{ order.orderDate | date:'short' }}</td>
                            <td>
                                <button (click)="updateOrderStatus(order.id!, 'EXP√âDI√â')"
                                    *ngIf="order.status === 'PENDING'">Exp√©dier</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- View: Contact -->
        <div *ngIf="currentView === 'contact'" class="contact-view animate-in">
            <div class="contact-container">
                <h2>‚úâÔ∏è {{ t('contact_title') }}</h2>
                <div class="contact-form">
                    <input [(ngModel)]="contactForm.name" placeholder="Nom" type="text">
                    <input [(ngModel)]="contactForm.email" placeholder="Email" type="email">
                    <input [(ngModel)]="contactForm.subject" placeholder="Sujet" type="text">
                    <textarea [(ngModel)]="contactForm.message" placeholder="Votre message"></textarea>
                    <button class="btn-send" (click)="sendContact()">{{ t('send') }}</button>
                </div>
                <div class="alert-success" *ngIf="contactMsgSent">
                    Message envoy√© avec succ√®s ! Nous vous r√©pondrons bient√¥t.
                </div>
            </div>
        </div>
    </div>

    <!-- Side Cart -->
    <div class="cart-drawer" [class.open]="isCartOpen">
        <div class="drawer-header">
            <h3>{{ t('cart') }} ({{ cart.length }})</h3>
            <button class="close-btn" (click)="toggleCart()">‚úï</button>
        </div>
        <div class="drawer-body">
            <div class="cart-item" *ngFor="let item of cart; let i = index">
                <span>{{ item.name }}</span>
                <b>${{ item.price }}</b>
                <button (click)="removeFromCart(i)">üóë</button>
            </div>
        </div>
        <div class="drawer-footer" *ngIf="cart.length > 0">
            <div class="cart-total">
                <span>{{ t('total') }}</span>
                <span>${{ total | number:'1.2-2' }}</span>
            </div>
            <div class="checkout-form">
                <input [(ngModel)]="customer.name" placeholder="Nom Complet" type="text">
                <input [(ngModel)]="customer.email" placeholder="Email" type="email">
                <button (click)="checkout()" [disabled]="!customer.name || !customer.email">{{ t('checkout') }}</button>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div class="success-overlay" *ngIf="orderPlaced">
        <div class="success-card">
            <div class="success-icon">‚úì</div>
            <h2>{{ t('order_success') }}</h2>
            <button (click)="orderPlaced = false" class="btn-close">Continuer</button>
        </div>
    </div>

</div>