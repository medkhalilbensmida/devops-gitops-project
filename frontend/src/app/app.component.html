<!-- Global Navigation (Fixed) -->
<nav class="glass-nav">
    <div class="nav-content">
        <div class="brand" (click)="switchView('shop')">TECH<span>HUB</span></div>

        <div class="nav-links" *ngIf="currentView === 'shop'">
            <button *ngFor="let cat of categories" [class.active]="currentCategory === cat"
                (click)="currentCategory = cat">
                {{ cat }}
            </button>
        </div>

        <div class="nav-meta">
            <div class="search-bar" *ngIf="currentView === 'shop'">
                <span>üîç</span>
                <input [(ngModel)]="searchQuery" placeholder="Search tech..." type="text">
            </div>

            <button class="view-toggle" (click)="switchView(currentView === 'shop' ? 'admin' : 'shop')">
                {{ currentView === 'shop' ? 'Dashboard Admin' : 'Back to Store' }}
            </button>

            <button class="cart-trigger" *ngIf="currentView === 'shop'" (click)="toggleCart()">
                <span class="icon">üõí</span>
                <span class="badge" *ngIf="cart.length">{{ cart.length }}</span>
            </button>
        </div>
    </div>
</nav>

<!-- Main Blurred Container (Content only) -->
<div class="main-wrapper" [class.is-blurred]="isCartOpen">

    <!-- SHOP VIEW -->
    <div *ngIf="currentView === 'shop'">
        <header class="hero-premium">
            <div class="hero-overlay"></div>
            <div class="hero-content">
                <span class="badge-mini">Advanced GitOps Deployments</span>
                <h1>Professional Tech Solutions</h1>
                <p>Scaling your infrastructure with high-performance hardware and software gear.</p>
            </div>
        </header>

        <main class="storefront">
            <div class="section-header">
                <h2>{{ currentCategory }} Collection</h2>
                <p>{{ filteredProducts.length }} products found</p>
            </div>

            <div class="grid-layout">
                <div class="premium-card" *ngFor="let product of filteredProducts">
                    <div class="card-image">
                        <img [src]="product.imageUrl" [alt]="product.name">
                        <div class="category-tag">{{ product.category }}</div>
                        <button class="quick-add" (click)="addToCart(product)">Add to Cart +</button>
                    </div>
                    <div class="card-body">
                        <h3>{{ product.name }}</h3>
                        <p>{{ product.description }}</p>
                        <div class="card-footer">
                            <span class="price-tag">${{ product.price | number:'1.2-2' }}</span>
                            <div class="stock-info">Available</div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- ADMIN VIEW -->
    <div *ngIf="currentView === 'admin'" class="admin-container">
        <div class="admin-header">
            <h1>Order Management Dashboard</h1>
            <button (click)="loadOrders()" class="refresh-btn">üîÑ Refresh Data</button>
        </div>

        <div class="admin-stats">
            <div class="stat-card">
                <label>Total Orders</label>
                <span>{{ orders.length }}</span>
            </div>
            <div class="stat-card">
                <label>Revenue</label>
                <span>${{ totalRevenue | number:'1.2-2' }}</span>
            </div>
        </div>

        <div class="orders-table-wrapper">
            <table class="orders-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Customer</th>
                        <th>Products</th>
                        <th>Date</th>
                        <th>Total</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let order of orders">
                        <td>#{{ order.id }}</td>
                        <td>
                            <b>{{ order.customerName }}</b><br>
                            <small>{{ order.customerEmail }}</small>
                        </td>
                        <td>
                            <ul class="order-items">
                                <li *ngFor="let p of order.productNames">{{ p }}</li>
                            </ul>
                        </td>
                        <td>{{ order.orderDate | date:'short' }}</td>
                        <td class="order-price">${{ order.totalAmount | number:'1.2-2' }}</td>
                        <td><span class="status-badge" [attr.data-status]="order.status">{{ order.status }}</span></td>
                        <td>
                            <div class="action-btns">
                                <button (click)="updateOrderStatus(order.id!, 'SHIPPED')"
                                    *ngIf="order.status === 'PENDING'">Ship</button>
                                <button (click)="updateOrderStatus(order.id!, 'DELIVERED')"
                                    *ngIf="order.status === 'SHIPPED'">Deliver</button>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- FIXED COMPONENTS (Not affected by blur) -->
<!-- Slide-out Cart Panel -->
<div class="side-panel" [class.active]="isCartOpen">
    <div class="panel-header">
        <h3>Shopping Cart</h3>
        <button class="close-btn" (click)="toggleCart()">‚úï</button>
    </div>

    <div class="panel-body">
        <div class="cart-scroll" *ngIf="cart.length > 0">
            <div class="cart-item-row" *ngFor="let item of cart; let i = index">
                <img [src]="item.imageUrl" [alt]="item.name">
                <div class="item-details">
                    <h4>{{ item.name }}</h4>
                    <span>${{ item.price }}</span>
                </div>
                <button class="del-btn" (click)="removeFromCart(i)">üóë</button>
            </div>
        </div>
        <div class="empty-state" *ngIf="cart.length === 0">
            <p>Your cart is empty.</p>
        </div>
    </div>

    <div class="panel-footer" *ngIf="cart.length > 0">
        <div class="total-summary">
            <span>Total</span>
            <span>${{ total | number:'1.2-2' }}</span>
        </div>
        <div class="checkout-fields">
            <input [(ngModel)]="customer.name" placeholder="Full Name" type="text">
            <input [(ngModel)]="customer.email" placeholder="Email Address" type="email">
            <button class="pay-btn" (click)="checkout()"
                [disabled]="!customer.name || !customer.email || cart.length === 0">
                Place Order & Pay Now
            </button>
        </div>
    </div>
</div>

<!-- Success Overlay -->
<div class="success-overlay" *ngIf="orderPlaced">
    <div class="success-box">
        <div class="check">‚úî</div>
        <h2>Order Received!</h2>
        <p>Your order for ${{ lastOrderTotal | number:'1.2-2' }} has been successfully placed.</p>
        <button (click)="orderPlaced = false" class="btn-main">Back to Shopping</button>
    </div>
</div>

<footer class="tech-footer">
    <div class="footer-content">
        <div class="brand">TECH<span>HUB</span></div>
        <p>The ultimate destination for next-gen hardware. Powered by Kubernetes & ArgoCD.</p>
    </div>
</footer>